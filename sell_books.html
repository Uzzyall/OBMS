<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBMS - Sell Books</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome (for icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnH/PRv8Rw+2E6D8bZ7lu4nKZJz69T1+M3UsPoYV+kJUVB3Aj2u/wJepd1Ylj3+Tr2+frwKYw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.CSS">
</head>
<body>
    <!-- Header Section (Same as index.html) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">OBMS</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Books</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="sell_books.html">Sell Books</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about_us.html">About us</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fa-solid fa-cart-plus"></i></a>
                    </li>
                    <li class="nav-item d-flex align-items-center ms-3">
                        <img src="./image/cart.png" alt="Cart" width="20">
                        <span id="cart-count" class="ms-1">0</span> Items | 
                        <span id="total-price" class="ms-1">NPR 0.00</span>
                    </li>
                    <li class="nav-item ms-3">
                        <a href="login.HTML" class="btn btn-outline-light">Login</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Sell Books Form Section -->
    <section class="py-5">
        <div class="container">
            <h2 class="mb-4 text-center">Sell Your Book</h2>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <form id="sellBookForm">
                        <!-- Book Image -->
                        <div class="mb-3">
                            <label for="bookImage" class="form-label">Book Image *</label>
                            <input class="form-control" type="file" id="bookImage" accept="image/*" required>
                        </div>
                        <!-- Book Name -->
                        <div class="mb-3">
                            <label for="bookName" class="form-label">Book Name *</label>
                            <input type="text" class="form-control" id="bookName" required>
                        </div>
                        <!-- Publication -->
                        <div class="mb-3">
                            <label for="publication" class="form-label">Publication *</label>
                            <input type="text" class="form-control" id="publication" required>
                        </div>
                        <!-- Print Date -->
                        <div class="mb-3">
                            <label for="printDate" class="form-label">Print Date *</label>
                            <input type="date" class="form-control" id="printDate" max="" required>
                        </div>
                        <!-- Book Print Price -->
                        <div class="mb-3">
                            <label for="bookPrintPrice" class="form-label">Book Print Price (NPR) *</label>
                            <input type="number" class="form-control" id="bookPrintPrice" min="0" required>
                        </div>
                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" rows="3" required></textarea>
                        </div>
                        <!-- Today's Price -->
                        <div class="mb-3">
                            <label for="todaysPrice" class="form-label">Today's Price (NPR)</label>
                            <input type="number" class="form-control" id="todaysPrice" readonly>
                        </div>
                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-success w-100">Submit</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Popup Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="successModalLabel">Success!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Your book has been successfully listed for sale!
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Section (Same as index.html) -->
    <footer class="bg-primary text-white py-4">
        <div class="container text-center">
            <p>OBMS - Old Book Management System. Buy and sell used books easily.</p>
            <div class="d-flex justify-content-center">
                <a href="https://www.instagram.com/uzzyall/" target="_blank" class="text-white me-3">
                    <img src="image/insta_logo.jpeg" alt="Instagram Logo" width="20"> Instagram
                </a>
                <a href="https://www.facebook.com/profile.php?id=100026353981986" target="_blank" class="text-white">
                    <img src="image/Facebook_logo.png" alt="Facebook Logo" width="20"> Facebook
                </a>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="script.js"></script>
    <script>
        // JavaScript for Sell Books Form

        document.addEventListener('DOMContentLoaded', function () {
            // Set the max attribute of the printDate input to today's date
            const printDateInput = document.getElementById('printDate');
            const today = new Date().toISOString().split('T')[0];
            printDateInput.setAttribute('max', today);

            // Handle Today's Price Calculation
            const printDateField = document.getElementById('printDate');
            const bookPrintPriceField = document.getElementById('bookPrintPrice');
            const todaysPriceField = document.getElementById('todaysPrice');

            function calculateTodaysPrice() {
                const printDate = new Date(printDateField.value);
                const bookPrintPrice = parseFloat(bookPrintPriceField.value);

                if (!isNaN(printDate) && !isNaN(bookPrintPrice)) {
                    const currentDate = new Date();
                    let age = currentDate.getFullYear() - printDate.getFullYear();

                    // Adjust age if the current date is before the print date's month/day
                    const m = currentDate.getMonth() - printDate.getMonth();
                    if (m < 0 || (m === 0 && currentDate.getDate() < printDate.getDate())) {
                        age--;
                    }

                    age = age < 0 ? 0 : age;

                    // Example Algorithm: Decrease price by 5% per year
                    const depreciationRate = 0.05; // 5% per year
                    let todaysPrice = bookPrintPrice * (1 - (depreciationRate * age));

                    // Ensure Today's Price is not less than 50% of Book Print Price
                    const minimumPrice = bookPrintPrice * 0.5;
                    if (todaysPrice < minimumPrice) {
                        todaysPrice = minimumPrice;
                    }

                    // Round to two decimal places
                    todaysPrice = Math.round(todaysPrice * 100) / 100;

                    todaysPriceField.value = todaysPrice;
                } else {
                    todaysPriceField.value = '';
                }
            }

            // Event Listeners for calculating Today's Price
            printDateField.addEventListener('change', calculateTodaysPrice);
            bookPrintPriceField.addEventListener('input', calculateTodaysPrice);

            // Handle Form Submission
            const sellBookForm = document.getElementById('sellBookForm');
            sellBookForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Simple validation
                const bookImage = document.getElementById('bookImage').files[0];
                const bookName = document.getElementById('bookName').value.trim();
                const publication = document.getElementById('publication').value.trim();
                const printDate = document.getElementById('printDate').value;
                const bookPrintPrice = parseFloat(document.getElementById('bookPrintPrice').value);
                const description = document.getElementById('description').value.trim();
                const todaysPrice = parseFloat(document.getElementById('todaysPrice').value);

                if (!bookImage || !bookName || !publication || !printDate || isNaN(bookPrintPrice) || !description || isNaN(todaysPrice)) {
                    alert('Please fill in all the required fields correctly.');
                    return;
                }

                // Since there's no backend, we'll simulate form submission
                // Reset the form
                sellBookForm.reset();
                todaysPriceField.value = '';

                // Hide any existing modal
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
            });
        });
    </script>
</body>
</html>
